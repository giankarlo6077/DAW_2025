<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados - {{ historial.titulo_cuestionario }}</title>
    <style>
        /* Definici√≥n de variables de color para f√°cil mantenimiento */
        :root {
            --color-primary: #667eea; /* Azul/Morado claro */
            --color-secondary: #764ba2; /* Morado oscuro */
            --color-success: #38ef7d; /* Verde vibrante */
            --color-success-dark: #11998e; /* Verde oscuro */
            --color-error: #e74c3c; /* Rojo de error */
            --color-background: #f4f7f6; /* Fondo claro sutil */
            --color-card-bg: #ffffff; /* Fondo de tarjeta blanco */
            --color-text-dark: #333;
            --color-text-muted: #666;
        }

        /* Base y Tipograf√≠a */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--color-background);
            background-image: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); /* Tu gradiente original */
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Encabezado de Resultados */
        .results-header {
            background: var(--color-card-bg);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); /* Sombra suave */
            margin-bottom: 30px;
            border-bottom: 5px solid var(--color-success); /* Toque de color de √©xito */
        }
        .trophy-icon {
            font-size: 80px;
            margin-bottom: 15px;
            display: inline-block;
            color: var(--color-success); /* Color de √©xito */
        }
        .results-header h1 {
            color: var(--color-text-dark);
            font-size: 36px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        .results-header h2 {
            color: var(--color-primary);
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 25px;
        }

        /* C√≠rculos de Puntuaci√≥n - Se mantienen tus gradientes */
        .score-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin: 30px 0;
        }
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-success-dark) 0%, var(--color-success) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
            transition: transform 0.3s;
        }
        .score-circle:hover {
            transform: scale(1.05);
        }
        .score-circle .number {
            font-size: 50px;
            font-weight: bold;
            line-height: 1;
        }
        .score-circle .label {
            font-size: 15px;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Tarjetas de Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: #f8f9fa; /* Fondo gris claro */
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: background-color 0.3s;
            border: 1px solid #e9ecef;
        }
        .stat-card:hover {
            background-color: #e9ecef;
        }
        .stat-card .icon {
            font-size: 30px;
            margin-bottom: 5px;
        }
        .stat-card .value {
            font-size: 30px;
            font-weight: bold;
            color: var(--color-text-dark);
        }
        .stat-card:nth-child(1) .value { color: var(--color-success-dark); }
        .stat-card:nth-child(2) .value { color: var(--color-error); }
        .stat-card:nth-child(3) .value { color: var(--color-primary); }
        .stat-card:nth-child(4) .value { color: #f8c057; }

        .stat-card .label {
            font-size: 13px;
            color: var(--color-text-muted);
            margin-top: 5px;
        }

        /* Secci√≥n de Detalles/Revisi√≥n */
        .details-section {
            background: var(--color-card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        .details-section h3 {
            color: var(--color-text-dark);
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-primary); /* L√≠nea de acento */
            font-weight: 600;
        }
        .question-review {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            background: #fcfcfc;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        .question-review.correct {
            border-left: 5px solid var(--color-success);
            background: #e6fff1; /* Fondo muy claro de √©xito */
        }
        .question-review.incorrect {
            border-left: 5px solid var(--color-error);
            background: #fff0f0; /* Fondo muy claro de error */
        }

        .question-review .question-number {
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 10px;
       }
        .question-review .question-text {
            font-size: 17px;
            color: var(--color-text-dark);
            margin-bottom: 15px;
            font-weight: 600;
            padding-top: 10px;
        }
        .options-review {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        .option-review {
            padding: 12px 15px;
            border-radius: 8px;
            background: #ffffff;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #e9ecef;
        }
        .option-review .letter {
            min-width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--color-text-muted);
            font-size: 14px;
        }

        /* Estilos de Opci√≥n: Correcta, Incorrecta y Seleccionada */
        .option-review.correct {
            background: #d4edda; /* Mantenemos tu color de √©xito */
            border-color: var(--color-success);
        }
        .option-review.correct .letter {
            background: var(--color-success);
            color: white;
        }
        .option-review.incorrect {
            background: #f8d7da; /* Mantenemos tu color de error */
            border-color: var(--color-error);
        }
        .option-review.incorrect .letter {
            background: var(--color-error);
            color: white;
        }
        .option-review.selected {
            border: 2px solid var(--color-primary); /* Resaltar la selecci√≥n del estudiante */
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-correct {
            background: var(--color-success);
            color: white;
        }
        .badge-incorrect {
            background: var(--color-error);
            color: white;
        }
        .option-review .text span {
            color: var(--color-primary);
            font-weight: 600;
        }
        .option-review .text {
            color: var(--color-text-dark);
        }

        /* Botones */
       (Botones)
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--color-success-dark) 0%, var(--color-success) 100%); /* Tu gradiente principal */
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
     box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
   }

        /* Informaci√≥n del pie de p√°gina */
        .footer-info {
            text-align: center;
            color: white; /* Blanco para contrastar con el fondo del body */
            margin-top: 30px;
            font-size: 14px;
            padding: 10px 0;
            opacity: 0.9;
        }
      .footer-info p {
            margin-bottom: 5px;
        }

        /* Media Queries para Responsividad */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .score-display {
                flex-direction: column;
             gap: 20px;
            }
        }
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .results-header h1 {
            content font-size: 30px;
            }
            .score-circle {
                width: 120px;
                height: 120px;
            }
            .score-circle .number {
             font-size: 40px;
            }
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="results-header">
            <!-- CORRECCI√ìN: 'porcentaje' ahora viene de Python -->
            <!-- Se borr√≥ la l√≠nea {% set porcentaje = ... %} -->

            {% if porcentaje >= 80 %}
                <div class="trophy-icon">üèÜ</div>
            {% elif porcentaje >= 60 %}
                <div class="trophy-icon">‚≠ê</div>
       {% else %}
                <div class="trophy-icon">üìù</div>
            {% endif %}

            <h1>¬°Cuestionario Finalizado!</h1>
            <h2>{{ historial.titulo_cuestionario }}</h2>

            <div class="score-display">
                <div class="score-circle">
                    <div class="number">{{ historial.puntuacion_final }}</div>
                 <div class="label">PUNTOS</div>
                </div>
                <div class="score-circle">
                    <!-- CORRECCI√ìN: Usar la variable 'porcentaje' de Python -->
                    <div class="number">{{ porcentaje }}%</div>
                    <div class="label">PRECISI√ìN</div>
                </div>
            </div>

            <div class="stats-grid">
             <div class="stat-card">
                    <div class="icon">‚úÖ</div>
                    <!-- CORRECCI√ìN: Usar la variable 'correctas' de Python -->
                    <div class="value">{{ correctas }}</div>
                    <div class="label">Respuestas Correctas</div>
                </div>
                <div class="stat-card">
                    <div class="icon">‚ùå</div>
                    <!-- CORRECCI√ìN: Usar la variable 'incorrectas' de Python -->
                    <div class="value">{{ incorrectas }}</div>
                    <div class="label">Respuestas Incorrectas</div>
           </div>
                <div class="stat-card">
                    <div class="icon">üìù</div>
                    <div class="value">{{ historial.num_preguntas_total }}</div>
                 <div class="label">Preguntas Totales</div>
                </div>
                <div class="stat-card">
                    <div class="icon">‚è±Ô∏è</div>
                    <div class="value">{{ historial.tiempo_total }}s</div>
                 <div class="label">Tiempo Total</div>
                </div>
            </div>

            <div class="actions">
                <a href="{{ url_for('dashboard_estudiante') }}" class="btn btn-primary">
                    üè† Volver al Dashboard
             </a>
            </div>
        </div>

        <div class="details-section">
            <h3>üìã Revisi√≥n Detallada</h3>

            {% for respuesta in respuestas %}
            <div class="question-review {{ 'correct' if respuesta.es_correcta else 'incorrect' }}">
                <div class="question-number">
                    <span>Pregunta {{ loop.index }}</span>
                    {% if respuesta.es_correcta %}
                        <span class="badge badge-correct">‚úì CORRECTA</span>
                    {% else %}
                        <span class="badge badge-incorrect">‚úó INCORRECTA</span>
                    {% endif %}
                </div>
                <div class="question-text">{{ respuesta.pregunta }}</div>

                <div class="options-review">
                    {% set opciones = [
                        ('A', respuesta.opcion_a),
                   ('B', respuesta.opcion_b),
                        ('C', respuesta.opcion_c),
                        ('D', respuesta.opcion_d)
                    ] %}
                    {% for letra, texto in opciones %}
                 <div class="option-review
                        {{ 'correct' if letra == respuesta.respuesta_correcta else '' }}
                        {{ 'incorrect' if letra == respuesta.respuesta_estudiante and not respuesta.es_correcta else '' }}
                        {{ 'selected' if letra == respuesta.respuesta_estudiante else '' }}">
                     <div class="letter">{{ letra }}</div>
                        <div class="text">
                            {{ texto }}
                            {% if letra == respuesta.respuesta_correcta %}
                                <span style="font-weight: 600; margin-left: 5px; color: var(--color-success-dark);">(Correcta)</span>
                         {% endif %}
                         {% if letra == respuesta.respuesta_estudiante %}
                                <span style="margin-left: 5px;">(Tu respuesta)</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div style="margin-top: 15px; font-size: 14px; color: var(--color-text-muted);">
                    ‚è±Ô∏è Tiempo de respuesta: **{{ respuesta.tiempo_respuesta }}s** |
                   üíØ Puntos: **{{ respuesta.puntos }}**
                </div>
            </div>
            {% endfor %}
        </div>

     <div class="footer-info">
    <p>Estudiante: <strong>{{ historial.nombre_estudiante }}</strong></p>
    <p>Fecha: <strong>{{ fecha_realizacion_str }}</strong></p>
</div>
    </div>
</body>
</html>

